!function(){function e(e){if(!window.EventSource)throw new Error("Realtime plugin requires EventSource support");this.eventSource=new window.EventSource(e)}e.prototype={constructor:e,on:function(e,t){this.eventSource.addEventListener(e,t,!1)},off:function(e,t){this.eventSource.removeEventListener(e,t)},destroy:function(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}},Crocodoc.Realtime=e,Crocodoc.addPlugin("realtime",function(e){"use strict";function t(e){try{return l.parseJSON(e.data)}catch(t){return e.data}}function n(t){var n,o;for(n=0;n<t.length;++n)o=t[n],f.fire("realtimeupdate",{page:o}),e.broadcast("pageavailable",{page:o})}function o(e){var o=t(e);n(o.pages)}function r(e){var n=t(e);f.fire("realtimeerror",{error:n}),u.destroy()}function i(){e.broadcast("pageavailable",{all:!0}),f.fire("realtimecomplete"),u.destroy()}function a(e){var n=t(e);n&&(f.fire("realtimeerror",{error:n.message}),n.close&&u.destroy())}function c(){e.getUtility("support").svg?(u.on("pageavailable.svg",o),u.on("finished.svg",i),u.on("failed.svg",r)):(u.on("pageavailable.png",o),u.on("finished.png",i),u.on("failed.png",r)),u.on("error",a)}var u,l=e.getUtility("common"),s=e.getConfig(),f=s.api;return{init:function(e){var t=e.url;t&&(u=new Crocodoc.Realtime(t),s.conversionIsComplete=!1,c())},destroy:function(){u&&(u.destroy(),u=null),l=f=s=null}}})}();