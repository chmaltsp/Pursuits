!function(e){"use strict";e.Crocodoc=function(e){return"object"!=typeof exports?e(jQuery):void(module.exports=e)}(function(t){if("undefined"==typeof t)throw new Error("jQuery is required");var n=function(){function e(n,a,o){var i;for(o=o||n,i=0;i<a.length;++i){if(n===a[i])throw new Error("Circular dependency detected: "+o+"->"+a[i]);t[a[i]]&&e(n,t[a[i]].mixins,o+"->"+a[i])}}var t={},a={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",ASSET_REQUEST_RETRIES:1,components:t,utilities:a,createViewer:function(e,t){return new n.Viewer(e,t)},getViewer:function(e){return n.Viewer.get(e)},addComponent:function(n,a,o){a instanceof Function&&(o=a,a=[]),e(n,a),t[n]={mixins:a,creator:o}},createComponent:function(e,n){var a=t[e];if(a){for(var o=[],i=0;i<a.mixins.length;++i)o.push(this.createComponent(a.mixins[i],n));return o.unshift(n),a.creator.apply(a.creator,o)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addDataProvider:function(e,t){this.addComponent("data-provider-"+e,t)},addUtility:function(e,t){a[e]={creator:t,instance:null}},getUtility:function(e){var t=a[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){n.Scope=function(e){function a(e,t){var n,a,o,s;for(n=0,a=r.length;a>n;++n)o=r[n],o&&(s=o.messages||[],-1!==i.inArray(e,s)&&"function"==typeof o.onmessage&&o.onmessage.call(o,e,t))}function o(){for(var e;s.length;)e=s.shift(),a(e.name,e.data);s=null}var i=n.getUtility("common"),r=[],s=[],l={},c=!1;e.dataProviders=e.dataProviders||{},this.createComponent=function(e){var t=n.createComponent(e,this);return t&&(t.componentName=e,r.push(t)),t},this.destroyComponent=function(e){var t,n;for(t=0,n=r.length;n>t;++t)if(e===r[t]){"function"==typeof e.destroy&&e.destroy(),r.splice(t,1);break}},this.destroy=function(){var e,t,n;for(e=0,t=r.length;t>e;++e)n=r[e],"function"==typeof n.destroy&&n.destroy();r=[],l={}},this.broadcast=function(e,t){c?a(e,t):s.push({name:e,data:t})},this.getUtility=function(e){return n.getUtility(e)},this.getConfig=function(){return e},this.ready=function(){c||(c=!0,o())},this.get=function(n,a){var o=e.dataProviders[n]||n,i=this.getDataProvider(o);return i?i.get(n,a):t.Deferred().reject("data-provider not found").promise()},this.getDataProvider=function(e){var t;return l[e]?t=l[e]:(t=this.createComponent("data-provider-"+e),l[e]=t),t}}}(),function(){function e(e,t){var n=!1;return{type:e,data:t,preventDefault:function(){n=!0},isDefaultPrevented:function(){return n}}}n.EventTarget=function(){this._handlers={}},n.EventTarget.prototype={constructor:n.EventTarget,on:function(e,t){"undefined"==typeof this._handlers[e]&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(t,n){var a,o,i,r=e(t,n);if(a=this._handlers[r.type],a instanceof Array)for(a=a.concat(),o=0,i=a.length;i>o;o++)a[o]&&a[o].call(this,r);if(a=this._handlers.all,a instanceof Array)for(a=a.concat(),o=0,i=a.length;i>o;o++)a[o]&&a[o].call(this,r);return r},off:function(e,t){var n,a,o=this._handlers[e];if(o instanceof Array){if(!t)return void(o.length=0);for(n=0,a=o.length;a>n;n++)if(o[n]===t||o[n].handler===t){o.splice(n,1);break}}},one:function(e,t){var n=this,a=function(o){n.off(e,a),t.call(n,o)};a.handler=t,this.on(e,a)}}}(),function(){var e="crocodoc-text-disabled",a="crocodoc-links-disabled",o=0,i={};n.Viewer=function(r,s){function l(){h.init()}n.EventTarget.call(this);var c,u=n.getUtility("common"),d=t(r),g=u.extend(!0,{},n.Viewer.defaults,s),f=new n.Scope(g),h=f.createComponent("viewer-base");if(0===d.length)throw new Error("Invalid container element");this.id=g.id=++o,g.api=this,g.$el=d,i[this.id]=this,this.destroy=function(){delete i[g.id],f.broadcast("destroy"),f.destroy()},this.load=function(){h.loadAssets()},this.setLayout=function(e){c=null,c=h.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);c&&(t&&(e=t/(g.pageScale||1)),c.setZoom(e))},this.scrollTo=function(e){c&&c.scrollTo(e)},this.scrollBy=function(e,t){c&&c.scrollBy(e,t)},this.focus=function(){c&&c.focus()},this.enableTextSelection=function(){g.enableTextSelection||(d.removeClass(e),g.enableTextSelection=!0,f.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){g.enableTextSelection&&(d.addClass(e),g.enableTextSelection=!1,f.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){g.enableLinks||(d.removeClass(a),g.enableLinks=!0)},this.disableLinks=function(){g.enableLinks&&(d.addClass(a),g.enableLinks=!1)},this.updateLayout=function(){c&&(c.updatePageStates(!0),c.setZoom())},l()},n.Viewer.prototype=new n.EventTarget,n.Viewer.prototype.constructor=n.Viewer,n.Viewer.get=function(e){return i[e]},n.Viewer.defaults={url:null,layout:n.LAYOUT_VERTICAL,zoom:n.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},dataProviders:{metadata:"metadata",stylesheet:"stylesheet","page-svg":"page-svg","page-text":"page-text","page-img":"page-img"},pageStart:null,pageEnd:null,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),n.addDataProvider("metadata",function(e){function t(e){return o.parseJSON(e)}var a=e.getUtility("ajax"),o=e.getUtility("common"),i=e.getConfig();return{get:function(){var e=this.getURL(),o=a.fetch(e,n.ASSET_REQUEST_RETRIES);return o.then(t).promise({abort:o.abort})},getURL:function(){var e=i.template.json;return i.url+e+i.queryString}}}),n.addDataProvider("page-img",function(e){var a=e.getUtility("common"),o=e.getConfig();return{get:function(e,a){function o(){r.setAttribute("src",c)}function i(){r.removeAttribute("src")}var r=this.getImage(),s=n.ASSET_REQUEST_RETRIES,l=!1,c=this.getURL(a),u=t.Deferred();return r.onload=function(){l=!0,u.resolve(r)},r.onerror=function(){s>0?(s--,i(),o()):(r=null,l=!1,u.reject({error:"image failed to load",resource:c}))},o(),u.promise({abort:function(){l||(i(),u.reject())}})},getURL:function(e){var t=a.template(o.template.img,{page:e});return o.url+t+o.queryString},getImage:function(){return new Image}}}),n.addDataProvider("page-svg",function(e){function t(e,t){var n="<style>"+t+"</style>";return s.firefox&&!l.isSubpxSupported()&&(n+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(/<xhtml:link[^>]*>/,n)}function a(n){if(!u){var a,r=c.queryString.replace("&","&#38;");return a=i.countInStr(n,'xlink:href="data:image'),a>o&&(n=n.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),n=n.replace(/href="([^"#:]*)"/g,function(e,t){return'href="'+c.url+t+r+'"'}),e.get("stylesheet").then(function(e){return t(n,e)})}}var o=1e3,i=e.getUtility("common"),r=e.getUtility("ajax"),s=e.getUtility("browser"),l=e.getUtility("subpx"),c=e.getConfig(),u=!1,d={};return{get:function(e,t){var o,i=this.getURL(t);return d[t]?d[t]:(o=r.fetch(i,n.ASSET_REQUEST_RETRIES),d[t]=o.then(a).promise({abort:function(){o.abort(),d&&delete d[t]}}),d[t])},getURL:function(e){var t=i.template(c.template.svg,{page:e});return c.url+t+c.queryString},destroy:function(){u=!0,i=r=l=s=c=d=null}}}),n.addDataProvider("page-text",function(e){function t(e){if(!s){var t=o.countInStr(e,"<div");return t>a?"":e=e.replace(/<link rel="stylesheet".*/,"")}}var a=256,o=e.getUtility("common"),i=e.getUtility("ajax"),r=e.getConfig(),s=!1,l={};return{get:function(e,a){var o,r=this.getURL(a);return l[a]?l[a]:(o=i.fetch(r,n.ASSET_REQUEST_RETRIES),l[a]=o.then(t).promise({abort:function(){o.abort(),l&&delete l[a]}}),l[a])},getURL:function(e){var t=o.template(r.template.html,{page:e});return r.url+t+r.queryString},destroy:function(){s=!0,o=i=r=l=null}}}),n.addDataProvider("stylesheet",function(e){function t(e){return i.ie&&(e=e.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+r.id)),e}var a,o=e.getUtility("ajax"),i=e.getUtility("browser"),r=e.getConfig();return{get:function(){if(a)return a;var e=o.fetch(this.getURL(),n.ASSET_REQUEST_RETRIES);return a=e.then(t).promise({abort:function(){e.abort(),a=null}})},getURL:function(){var e=r.template.css;return r.url+e+r.queryString},destroy:function(){o=i=r=null,a=null}}}),n.addUtility("ajax",function(e){function n(e){var t,n,a;try{t=e.status,n=e.statusText,a=e.responseText}catch(o){t=0,n="",a=null}return{status:t,statusText:n,responseText:a,rawRequest:e}}function a(e){return"file:"===d.parse(e).protocol}function o(e){return e>=200&&300>e||304===e}function i(e){return e=c.extend(!0,{},e||{}),e.method=e.method||"GET",e.headers=e.headers||[],e.data=e.data||"","string"!=typeof e.data&&(e.data=t.param(e.data),"GET"!==e.method&&(e.data=e.data,e.headers.push(["Content-Type","application/x-www-form-urlencoded"]))),e}function r(e,t){var n;for(n=0;n<t.length;++n)e.setRequestHeader(t[n][0],t[n][1])}function s(e,t,n,i,s,l){var c=u.getXHR();return c.open(t,e,!0),c.onreadystatechange=function(){var t;if(4===c.readyState){c.onreadystatechange=function(){};try{t=c.status}catch(n){return void l(c)}0===t&&a(e)&&(t=200),o(t)?s(c):l(c)}},r(c,i),c.send(n),c}function l(e,t,n,a,o){var i=u.getXDR();try{i.open(t,e),i.onload=function(){a(i)},i.onerror=function(){o(i)},i.ontimeout=function(){o(i)},i.onprogress=function(){},i.send(n)}catch(r){return o({status:0,statusText:r.message})}return i}var c=e.getUtility("common"),u=e.getUtility("support"),d=e.getUtility("url");return{request:function(e,t){function a(e){return c.isFn(r.success)&&r.success.call(n(e)),e}function o(e){return c.isFn(r.fail)&&r.fail.call(n(e)),e}var r=i(t),g=r.method,f=r.data,h=r.headers;return"GET"===g&&f&&(e=d.appendQueryParams(e,f),f=""),u.isXHRSupported()?d.isCrossDomain(e)&&!u.isCORSSupported()?l(e,g,f,a,o):s(e,g,f,h,a,o):r.fail({status:0,statusText:"AJAX not supported"})},fetch:function(e,n){function a(e){n>0?(n--,i=o()):l.reject(e)}function o(){return s.request(e,{success:function(){r||(this.responseText?l.resolve(this.responseText):a({error:"empty response",status:this.status,resource:e}))},fail:function(){r||a({error:this.statusText,status:this.status,resource:e})}})}var i,r=!1,s=this,l=t.Deferred();return i=o(),l.promise({abort:function(){r=!0,i.abort()}})}}}),n.addUtility("browser",function(){var e,t=navigator.userAgent,n={},a=/ip(hone|od|ad)/i.test(t),o=/android/i.test(t),i=/blackberry/i.test(t),r=/webos/i.test(t),s=/silk|kindle/i.test(t),l=/MSIE|Trident/i.test(t);return l&&(n.ie=!0,e=/MSIE/i.test(t)?/MSIE\s+(\d+\.\d+)/i.exec(t):/Trident.*rv[ :](\d+\.\d+)/.exec(t),n.version=e&&parseFloat(e[1]),n.ielt9=n.version<9,n.ielt10=n.version<10,n.ielt11=n.version<11),a&&(n.ios=!0,e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n.version=e&&parseFloat(e[1]+"."+e[2])),n.mobile=/mobile/i.test(t)||a||o||i||r||s,n.firefox=/firefox/i.test(t),/safari/i.test(t)&&(n.chrome=/chrome/i.test(t),n.safari=!n.chrome),n.safari&&(e=navigator.appVersion.match(/Version\/(\d+(\.\d+)?)/),n.version=e&&parseFloat(e[1])),n}),n.addUtility("common",function(){var n=1.33333,a={};return a.extend=t.extend,a.each=t.each,a.map=t.map,a.param=t.param,a.parseJSON=t.parseJSON,a.stringifyJSON="undefined"!=typeof e.JSON?e.JSON.stringify:function(){throw new Error("JSON.stringify not supported")},t.extend(a,{bisectLeft:function(e,t,n){for(var a,o,i=0,r=e.length;r>i;)o=Math.floor((i+r)/2),a=n?e[o][n]:e[o],t>a?i=o+1:r=o;return i},bisectRight:function(e,t,n){for(var a,o,i=0,r=e.length;r>i;)o=Math.floor((i+r)/2),a=n?e[o][n]:e[o],a>t?r=o:i=o+1;return i},clamp:function(e,t,n){return t>e?t:e>n?n:e},sign:function(e){var t=parseInt(e,10);return t?0>t?-1:1:t},isFn:function(e){return"function"==typeof e},inArray:function(e,n){return a.isFn(n.indexOf)?n.indexOf(e):t.inArray(e,n)},constrainRange:function(e,t,n){var o=t-e;return e=a.clamp(e,0,n),t=a.clamp(e+o,0,n),o>t-e&&(e=a.clamp(t-o,0,n)),{min:e,max:t}},now:function(){return(new Date).getTime()},throttle:function(e,t){function n(){l=a.now(),r=null,s=t.apply(o,i)}var o,i,r,s,l=0;return function(){var c=a.now(),u=e-(c-l);return o=this,i=arguments,0>=u?(clearTimeout(r),r=null,l=c,s=t.apply(o,i)):r||(r=setTimeout(n,u)),s}},debounce:function(e,t){function n(){var c=a.now()-s;e>c?r=setTimeout(n,e-c):(r=null,l=t.apply(o,i),o=i=null)}var o,i,r,s,l;return function(){return o=this,i=arguments,s=a.now(),r||(r=setTimeout(n,e)),l}},insertCSS:function(e){var t=document.createElement("style"),n=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(n)}catch(a){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,n){var a;return e.insertRule?e.insertRule(t+"{"+n+"}",e.cssRules.length):(a=e.addRule(t,n,e.rules.length),0>a&&(a=e.rules.length-1),a)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var t,n,a;return e.getSelection?(n=e.getSelection(),n.rangeCount&&(a=n.getRangeAt(0),a.collapsed||(t=n.anchorNode.parentNode))):document.selection&&(t=document.selection.createRange().parentElement()),t},getComputedStyle:function(t){return"getComputedStyle"in e?e.getComputedStyle(t):t.currentStyle},calculatePtSize:function(){var e,t,o=1e4,i=document.createElement("div");return i.style.display="block",i.style.position="absolute",i.style.width=o+"pt",document.body.appendChild(i),e=a.getComputedStyle(i),t=e&&e.width?parseFloat(e.width)/o:n,document.body.removeChild(i),t},countInStr:function(e,t){for(var n,a=0;n=e.indexOf(t,n)+1;)a++;return a},template:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("\\{\\{"+n+"\\}\\}","g"),t[n]));return e}})}),n.addUtility("subpx",function(n){function a(){if(!t.support.leadingWhitespace)return!1;var n=t(r.template(i,{size:12.5})).appendTo(document.documentElement).get(0),a=t(n).css("font-size"),o=t(n).width();t(n).remove(),n=t(r.template(i,{size:12.6})).appendTo(document.documentElement).get(0);var s=t(n).css("font-size"),l=t(n).width();if(t(n).remove(),!("ontouchstart"in e)){if(a===s)return!1;if(o===l)return!1}return!0}var o="crocodoc-subpx-fix",i='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",r=n.getUtility("common"),s=a();return{fix:function(e){if(!s&&void 0!==document.body.style.zoom){var n=t("<div>").addClass(o);t(e).children().wrapAll(n)}return e},isSubpxSupported:function(){return s}}}),n.addUtility("support",function(){function t(e){var t,a,o,r=document.createElement("div");if(e in r.style)return e;if(t=e.charAt(0).toUpperCase()+e.substr(1),e in r.style)return e;for(a=0;a<i.length;++a)if(o=i[a]+t,o in r.style)return 0===o.indexOf("ms")&&(o="-"+o),n(o);return!1}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var a,o,i=["Moz","Webkit","O","ms"],r=null,s=null;return function(){var t=0,n=["ms","moz","webkit","o"];a=e.requestAnimationFrame,o=e.cancelAnimationFrame;for(var i=0;i<n.length&&!a;++i)a=e[n[i]+"RequestAnimationFrame"],o=e[n[i]+"CancelAnimationFrame"]||e[n[i]+"CancelRequestAnimationFrame"];a||(a=function(n){var a=(new Date).getTime(),o=Math.max(0,16-(a-t)),i=e.setTimeout(function(){n(a+o)},o);return t=a+o,i},o=function(e){clearTimeout(e)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:t("transform"),csstransition:t("transition"),csszoom:t("zoom"),isXHRSupported:function(){return null===r&&(r=!!this.getXHR()),r},isCORSSupported:function(){return null===s&&(s=this.isXHRSupported()&&"withCredentials"in this.getXHR()),s},isXDRSupported:function(){return"undefined"!=typeof e.XDomainRequest},getXHR:function(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}},getXDR:function(){return this.isXDRSupported()?new e.XDomainRequest:null},requestAnimationFrame:function(){return a.apply(e,arguments)},cancelAnimationFrame:function(){o.apply(e,arguments)}}}),n.addUtility("url",function(t){var n,a=t.getUtility("browser");return{getCurrentURL:function(){return e.location.href},makeAbsolute:function(e){return this.parse(e).href},isCrossDomain:function(e){var t=this.parse(e);return n||(n=this.parse(this.getCurrentURL())),t.hostname?t.protocol!==n.protocol||t.hostname!==n.hostname||t.port!==n.port:!1},appendQueryParams:function(e,t){return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},parse:function(e){var t,n=document.createElement("a");return n.href=e,a.ie&&e!==n.href&&(e=n.href,n.href=e),t=n.pathname,/^\//.test(t)||(t="/"+t),{href:n.href,protocol:n.protocol,host:n.host,hostname:n.hostname,port:n.port,pathname:t,hash:n.hash,search:n.search}}}}),n.addComponent("dragger",function(n){function a(e){r.scrollTop(s.top-(e.clientY-l.y)),r.scrollLeft(s.left-(e.clientX-l.x)),e.preventDefault()}function o(e){n.broadcast("dragend"),c.off("mousemove",a),c.off("mouseup",o),e.preventDefault()}function i(e){n.broadcast("dragstart"),s={top:r.scrollTop(),left:r.scrollLeft()},l={x:e.clientX,y:e.clientY},c.on("mousemove",a),c.on("mouseup",o),e.preventDefault()}var r,s,l,c=t(e);return{init:function(e){r=t(e),r.on("mousedown",i)},destroy:function(){r.off("mousedown",i),r.off("mousemove",a),c.off("mouseup",o)}}}),n.addComponent("layout-base",function(t){function a(e,t){var n,a,o,i,r=e.state,s="."+e.config.namespace+" ."+c,l=e.config.stylesheet,u=r.pages,d=t*e.config.pageScale,g=100/d;for(i=y.csstransform?y.csstransform+":scale("+d+");width:"+g+"%;height:"+g+"%;":y.csszoom?"zoom:"+d:"",r.previousStyleIndex&&v.deleteCSSRule(l,r.previousStyleIndex),r.previousStyleIndex=v.appendCSSRule(l,s,i),n=0,a=u.length;a>n;++n)o=u[n],e.$pages.eq(n).css({width:o.actualWidth*t,height:o.actualHeight*t,paddingTop:o.paddingTop*t,paddingRight:o.paddingRight*t,paddingBottom:o.paddingBottom*t,paddingLeft:o.paddingLeft*t})}function o(e,t){if(!t||0===t.length)return 1/0;var n=v.map(t,function(t){return e[t].y1});return Math.max.apply(Math,n)}var i="crocodoc-layout-",r="crocodoc-current-page",s="crocodoc-page-",l=s+"visible",c=s+"autoscale",u="padding-",d=u+"top",g=u+"right",f=u+"left",h=u+"bottom",p=.95,m=.99,v=t.getUtility("common"),y=t.getUtility("support");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var e=t.getConfig();this.config=e,this.$el=e.$el,this.$doc=e.$doc,this.$viewport=e.$viewport,this.$pages=e.$pages,this.numPages=e.numPages,this.layoutClass=i+e.layout,this.$el.addClass(this.layoutClass),this.initState(),this.updatePageStates(),this.updateZoomLevels()},initState:function(){var t=this.$viewport[0],n=t;t===e&&(n=document.documentElement),this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,viewportDimensions:{clientWidth:n.clientWidth,clientHeight:n.clientHeight,offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],fullyVisiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(e){var a,o,i=this.state,r=this.parseZoomValue(e),s=i.zoomState,l=s.zoom;a=this.calculateZoomMode(e,r),r=v.clamp(r,i.minZoom,i.maxZoom),t.broadcast("beforezoom",v.extend({page:i.currentPage,visiblePages:v.extend([],i.visiblePages),fullyVisiblePages:v.extend([],i.fullyVisiblePages)},s)),s.prevZoom=l,s.zoom=r,s.zoomMode=a,this.applyZoom(r),s.canZoomIn=this.calculateNextZoomLevel(n.ZOOM_IN)!==!1,s.canZoomOut=this.calculateNextZoomLevel(n.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),o=e===n.ZOOM_AUTO||e===n.ZOOM_FIT_WIDTH||e===n.ZOOM_FIT_HEIGHT,this.updateScrollPosition(o),this.updatePageStates(),this.updateVisiblePages(!0),t.broadcast("zoom",v.extend({page:i.currentPage,visiblePages:v.extend([],i.visiblePages),fullyVisiblePages:v.extend([],i.fullyVisiblePages),isDraggable:this.isDraggable()},s))},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},parseZoomValue:function(e){var t=parseFloat(e),a=this.state,o=a.zoomState,i=o.zoom,r=i;if(t)r=t;else switch(e){case n.ZOOM_FIT_WIDTH:case n.ZOOM_FIT_HEIGHT:case n.ZOOM_AUTO:r=this.calculateZoomValue(e);break;case n.ZOOM_IN:case n.ZOOM_OUT:r=this.calculateNextZoomLevel(e)||i;break;default:r=i?o.zoomMode?this.calculateZoomValue(o.zoomMode):i:this.calculateZoomValue(this.config.zoom||n.ZOOM_AUTO)}return r},calculateZoomMode:function(e,t){switch(t){case this.calculateZoomValue(n.ZOOM_AUTO):return"string"!=typeof e||e!==n.ZOOM_FIT_WIDTH&&e!==n.ZOOM_FIT_HEIGHT?n.ZOOM_AUTO:e;case this.calculateZoomValue(n.ZOOM_FIT_WIDTH):return n.ZOOM_FIT_WIDTH;case this.calculateZoomValue(n.ZOOM_FIT_HEIGHT):return n.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function e(e){var t=a/e;return e===a?!1:p>t?!0:v.inArray(e,l)>-1&&m>t?!0:!1}var t,a,o=this.config.zoomLevels.slice()||[1],i=this.calculateZoomValue(n.ZOOM_AUTO),r=this.calculateZoomValue(n.ZOOM_FIT_WIDTH),s=this.calculateZoomValue(n.ZOOM_FIT_HEIGHT),l=[r,s];for(this.state.minZoom=this.config.minZoom||o[0],this.state.maxZoom=this.config.maxZoom||o[o.length-1],i!==r&&i!==s&&l.push(i),o=o.concat(l),o.sort(function(e,t){return e-t}),this.zoomLevels=[],a=0,t=0;t<o.length;++t)e(o[t])&&(a=o[t],this.zoomLevels.push(a))},calculateNextZoomLevel:function(e){var t,a=!1,o=this.state.zoomState.zoom,i=this.zoomLevels;if(e===n.ZOOM_IN){for(t=0;t<i.length;++t)if(i[t]>o){a=i[t];break}}else if(e===n.ZOOM_OUT)for(t=i.length-1;t>=0;--t)if(i[t]<o){a=i[t];break}return a},calculateZoomValue:function(e){var t=this.state,a=parseFloat(e);return a?a:e===n.ZOOM_FIT_WIDTH?t.viewportDimensions.clientWidth/t.widestPage.totalActualWidth:e===n.ZOOM_FIT_HEIGHT?t.viewportDimensions.clientHeight/t.tallestPage.totalActualHeight:e===n.ZOOM_AUTO?this.calculateZoomAutoValue():t.zoomState.zoom},applyZoom:function(e){a(this,e)},scrollTo:function(e){var t=this.state,a=parseInt(e,10);if("string"==typeof e){if(e===n.SCROLL_PREVIOUS&&t.currentPage>1)a=this.calculatePreviousPage();else if(e===n.SCROLL_NEXT&&t.currentPage<this.numPages)a=this.calculateNextPage();else if(!a)return}else if(!a&&0!==a)return;a=v.clamp(a,1,this.numPages),this.scrollToPage(a)},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=v.clamp(e-1,0,this.numPages-1),n=this.state.pages[t];return{top:n.y0,left:n.x0}},calculateVisibleRange:function(){var e=this.state,t=e.scrollTop,n=t+e.viewportDimensions.clientHeight,a=e.scrollLeft,o=a+e.viewportDimensions.clientWidth,i=v.bisectLeft(e.pages,t,"y1"),r=v.bisectRight(e.pages,n,"y0")-1,s=v.bisectLeft(e.pages,a,"x1"),l=v.bisectRight(e.pages,o,"x0")-1,c=Math.max(s,i),u=Math.min(l,r);return v.constrainRange(c,u,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.scrollTop,n=t+e.viewportDimensions.clientHeight,a=e.scrollLeft,o=a+e.viewportDimensions.clientWidth,i=v.bisectLeft(e.pages,t,"y0"),r=v.bisectRight(e.pages,n,"y1")-1,s=v.bisectLeft(e.pages,a,"x0"),l=v.bisectRight(e.pages,o,"x1")-1,c=Math.max(s,i),u=Math.min(l,r);return v.constrainRange(c,u,this.numPages-1)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},setCurrentPage:function(e){var n=this.state;n.currentPage!==e?(n.currentPage=e,this.updateVisiblePages(),t.broadcast("pagefocus",{page:n.currentPage,numPages:this.numPages,visiblePages:v.extend([],n.visiblePages),fullyVisiblePages:v.extend([],n.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,n,a,o=this.state,i=this.calculateVisibleRange(),r=this.calculateFullyVisibleRange();for(o.visiblePages.length=0,o.fullyVisiblePages.length=0,t=0,n=this.$pages.length;n>t;++t)a=this.$pages.eq(t),t<i.min||t>i.max?e&&a.hasClass(l)&&a.removeClass(l):(e&&!a.hasClass(l)&&a.addClass(l),o.visiblePages.push(t+1)),t>=r.min&&t<=r.max&&o.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t,n,a,i,r,s=this.state,l=s.pages,c=s.rows,u=this.$viewport.scrollTop(),p=this.$viewport.scrollLeft(),m=0,v=0,y=0,T=0;for(c.length=s.sumWidths=s.sumHeights=s.totalWidth=s.totalHeight=0,s.widestPage.totalActualWidth=s.tallestPage.totalActualHeight=0,t=0,n=this.$pages.length;n>t;++t)r=this.$pages.eq(t),i=r[0],a=l[t],(!a||e)&&(r.css("padding",""),a={index:t,paddingLeft:parseFloat(r.css(f)),paddingRight:parseFloat(r.css(g)),paddingTop:parseFloat(r.css(d)),paddingBottom:parseFloat(r.css(h))}),a.actualWidth||(a.actualWidth=parseFloat(i.getAttribute("data-width"))),a.actualHeight||(a.actualHeight=parseFloat(i.getAttribute("data-height"))),a.totalActualWidth=a.actualWidth+a.paddingLeft+a.paddingRight,a.totalActualHeight=a.actualHeight+a.paddingTop+a.paddingBottom,a.width=i.offsetWidth,a.height=i.offsetHeight,a.x0=i.offsetLeft,a.y0=i.offsetTop,a.x1=a.width+a.x0,a.y1=a.height+a.y0,v&&o(l,c[m])<=a.y0+2&&m++,v=a.y1,c[m]||(c[m]=[]),a.totalActualWidth>s.widestPage.totalActualWidth&&(s.widestPage=a),a.totalActualHeight>s.tallestPage.totalActualHeight&&(s.tallestPage=a),s.sumWidths+=a.width,s.sumHeights+=a.height,a.rowIndex=m,l[t]=a,c[m].push(t),l[y].x0+l[y].width<a.x0+a.width&&(y=t),l[T].y0+l[T].height<a.y0+a.height&&(T=t);s.totalWidth=l[y].x0+l[y].width,s.totalHeight=l[T].y0+l[T].height,s.scrollTop=u,s.scrollLeft=p,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.updateZoomLevels(),this.setZoom(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleScrollEnd:function(e){this.$doc.find("."+r).removeClass(r),this.$pages.eq(this.state.currentPage-1).addClass(r),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t,n,a=this.state,o=a.zoomState,i=o.zoom/o.prevZoom;t=a.scrollLeft*i,n=a.scrollTop*i,e!==!0&&(n+=a.viewportDimensions.offsetHeight*(i-1)/2,t+=a.viewportDimensions.offsetWidth*(i-1)/2),this.scrollToOffset(t,n)},focus:function(){this.$viewport.focus()},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1},extend:function(e){return v.extend({},this,e)}}}),n.addComponent("layout-"+n.LAYOUT_HORIZONTAL,["layout-base"],function(e,t){var a=e.getUtility("common"),o=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(n.ZOOM_FIT_WIDTH),a=this.calculateZoomValue(n.ZOOM_FIT_HEIGHT);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(t,a):o.mobile?a:Math.min(1,a)},calculateCurrentPage:function(){var e,t,n=this.state,o=n.pages;return e=a.bisectRight(o,n.scrollLeft,"x0")-1,t=a.bisectRight(o,n.scrollLeft+o[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,a=e.sumWidths,o=Math.floor(e.tallestPage.totalActualHeight*n),i=Math.max(a,e.viewportDimensions.clientWidth),r=Math.max(o,e.viewportDimensions.clientHeight);this.$doc.css({height:r,lineHeight:r+"px",width:i})}})}),n.addComponent("layout-"+n.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+n.LAYOUT_PRESENTATION],function(e,t){var a=e.getUtility("common");return t.extend({init:function(){this.twoPageMode=!0,t.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(e){var a=t.calculateZoomValue.call(this,e);return e===n.ZOOM_FIT_WIDTH&&(a/=2),a},scrollToPage:function(e){t.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return a.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),n.addComponent("layout-"+n.LAYOUT_PRESENTATION,["layout-base"],function(e,t){var a="crocodoc-page-",o=a+"prev",i=a+"next",r=a+"before",s=a+"after",l=a+"before-buffer",c=a+"after-buffer",u="crocodoc-current-page",d="crocodoc-preceding-page",g=[i,s,o,r,l,c].join(" "),f=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){t.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(g)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(n.ZOOM_FIT_WIDTH),t=this.calculateZoomValue(n.ZOOM_FIT_HEIGHT);return Math.min(e,t)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return f.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var n,a,o=f.clamp(e-1,0,this.numPages);t.setCurrentPage.call(this,e),this.$doc.find("."+d).removeClass(d),n=this.$doc.find("."+u),a=this.$pages.eq(o),n[0]!==a[0]&&(n.addClass(d).removeClass(u),a.addClass(u)),this.updateVisiblePages(!0),this.updatePageClasses(o)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e,t,n,a,o,i,r,s=this.state,l=s.zoomState,c=l.zoom,u=this.currentPage||1,d=s.pages[u-1],g=this.twoPageMode?s.pages[u]:d,f=s.viewportDimensions.clientWidth,h=s.viewportDimensions.clientHeight;e=g.actualWidth,t=d.actualWidth+(this.twoPageMode?e:0),n=d.actualHeight,a=Math.floor((t+d.paddingLeft+g.paddingRight)*c),o=Math.floor(d.totalActualHeight*c),i=Math.max(a,f),r=Math.max(o,h),this.$doc.css({width:i,height:r}),this.updatePageMargins(),i>f||r>h?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,n,a,o,i,r,s,l,c=this.state,u=c.viewportDimensions.clientWidth,d=c.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;t>e;++e)a=this.$pages.eq(e),n=c.pages[e],l=this.twoPageMode?e%2===1?n.paddingRight:n.paddingLeft:n.paddingRight+n.paddingLeft,o=(n.actualWidth+l)*c.zoomState.zoom,i=(n.actualHeight+n.paddingTop+n.paddingBottom)*c.zoomState.zoom,this.twoPageMode?(r=Math.max(0,(u-2*o)/2),e%2===1&&(r+=o)):r=(u-o)/2,s=(d-i)/2,r=Math.max(r,0),s=Math.max(s,0),a.css({marginLeft:r,marginTop:s})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,n=t+1,a=t-1,u=20;e.removeClass(g),this.twoPageMode?(n=t+2,a=t-2,e.slice(Math.max(a,0),t).addClass(o),e.slice(n,n+2).addClass(i)):(a>=0&&e.eq(a).addClass(o),n<this.numPages&&e.eq(n).addClass(i)),e.slice(0,t).addClass(r),e.slice(Math.max(0,t-u),t).addClass(l),e.slice(n).addClass(s),e.slice(n,Math.min(this.numPages,n+u)).addClass(c)}})}),n.addComponent("layout-"+n.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+n.LAYOUT_VERTICAL],function(e,t){return t}),n.addComponent("layout-"+n.LAYOUT_VERTICAL,["layout-base"],function(e,t){var a=e.getUtility("common"),o=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(n.ZOOM_FIT_WIDTH),a=this.calculateZoomValue(n.ZOOM_FIT_HEIGHT);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,t,a):o.mobile?t:Math.min(1,t)},calculateCurrentPage:function(){var e,t,n,o,i,r=this.state,s=r.pages;return e=a.bisectRight(s,r.scrollTop,"y0")-1,0>e?1:(i=r.scrollTop+s[e].height/2,t=a.bisectRight(s,i,"y0")-1,n=s[t].rowIndex,o=r.rows[n],1+o[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n+1];return a&&a[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n-1];return a&&a[0]+1||e.currentPage},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()
},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e,t,n=this.state,a=n.zoomState.zoom;e=Math.floor(n.widestPage.totalActualWidth*a),t=e<=n.viewportDimensions.clientWidth?"auto":e,this.$doc.css({width:t})}})}),n.addComponent("lazy-loader",function(e){function n(e){e=e||S;var t=O.page-1,n=t-e,a=t+e;return y.constrainRange(n,a,h-1)}function a(){var e;clearTimeout(v),P.length>0?(e=P.shift(),f[e]?b.loadPage(e,function(e){e===!1?a():v=setTimeout(a,A)}):a()):i()}function o(){clearTimeout(v),w=!1,v=setTimeout(a,A)}function i(){clearTimeout(v),w=!0}function r(e){P.push(e),w&&o()}function s(){P.length=0,i()}function l(e,t){var a=n(t);return e>=a.min&&e<=a.max?!0:!1}function c(e){var t=f[e];if(t){if(l(e))return!0;if(d(e))return!0}return!1}function u(e,t){return l(e,t)?!1:d(e)?!1:!0}function d(e){return y.inArray(e+1,O.visiblePages)>-1}function g(e,t){for(var n=y.sign(t-e);e!==t;)b.queuePageToLoad(e),e+=n;b.queuePageToLoad(e)}var f,h,p,m,v,y=e.getUtility("common"),T=e.getUtility("browser"),b={},P=[],S=1,w=!0,x=1,C=!1,O={page:1,visiblePages:[1]},A=T.mobile||T.ielt10?100:50,L=T.mobile||T.ielt10?8:32,E=1e3;return y.extend(b,{messages:["beforezoom","pageavailable","pagefocus","ready","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"ready":this.handleReady();break;case"scroll":this.handleScroll();break;case"scrollend":this.handleScrollEnd();break;case"zoom":this.handleZoom(t)}},init:function(e){f=e,h=f.length,S=Math.min(L,h)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){x=y.sign(e.page-O.page),O=e},loadNecessaryPages:y.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(O.page-1),this.loadVisiblePages(),this.loadPagesInRange(S)}),loadPagesInRange:function(e){var t=O.page-1;e>0&&(e=n(e),x>=0?(g(t+1,e.max),g(t-1,e.min)):(g(t-1,e.min),g(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=O.visiblePages.length;t>e;++e)this.queuePageToLoad(O.visiblePages[e]-1)},queuePageToLoad:function(e){c(e)&&(f[e].preload(),r(e))},cancelAllLoading:function(){clearTimeout(m),clearTimeout(p),s()},loadPage:function(e,n){t.when(f[e]&&f[e].load()).always(n)},unloadPage:function(e){var t=f[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,n;for(t=0,n=f.length;n>t;++t)u(t,e)&&this.unloadPage(t)},handleReady:function(){C=!0,this.loadVisiblePages(),m=setTimeout(function(){b.loadNecessaryPages()},E)},handlePageAvailable:function(e){if(C){var t;if(e.all===!0&&(e.upto=h),e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)}},handlePageFocus:function(e){this.updateLayoutState(e),C&&(this.cancelAllLoading(),p=setTimeout(function(){b.loadNecessaryPages()},200))},handleBeforeZoom:function(e){C&&(this.cancelAllLoading(),this.unloadUnnecessaryPages(2*e.visiblePages.length))},handleZoom:function(e){this.updateLayoutState(e),C&&this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){C&&(this.loadNecessaryPages(),this.unloadUnnecessaryPages(S))}})}),n.addComponent("page-img",function(e){var n,a,o,i,r=e.getUtility("browser"),s=!1,l=r.mobile;return{init:function(e,n){a=t(e),i=n},destroy:function(){l=!0,this.unload(),a.empty()},prepare:function(){},preload:function(){o||(o=e.get("page-img",i))},load:function(){return this.preload(),o.done(function(e){s||(s=!0,n=t(e).appendTo(a)),n.show()}),o.fail(function(t){s=!1,t&&e.broadcast("asseterror",t)}),o},unload:function(){o&&(o.abort(),o=null),l?(n&&(n.remove(),n=null),s=!1):n&&n.hide()}}}),n.addComponent("page-links",function(e){function n(e){var n=t("<a>").addClass(i),s=e.bbox[0],l=e.bbox[1],c={};if(r.ie&&t("<span>").appendTo(n).on("click",a),n.css({left:s+"pt",top:l+"pt",width:e.bbox[2]-s+"pt",height:e.bbox[3]-l+"pt"}),e.uri){if(!/^http|^mailto/.test(e.uri))return;c.href=encodeURI(e.uri),c.target="_blank"}else e.destination&&(c.href="#page-"+e.destination.pagenum);n.attr(c),n.data("link",e),n.appendTo(o)}function a(n){var a=r.ie?n.target.parentNode:n.target,o=t(a),i=o.data("link");i&&e.broadcast("linkclick",i),n.preventDefault()}var o,i="crocodoc-page-link",r=e.getUtility("browser");return{init:function(e,n){o=t(e),this.createLinks(n),r.ie||o.on("click","."+i,a)},destroy:function(){o.empty().off("click"),o=r=null},createLinks:function(e){var t,a;for(t=0,a=e.length;a>t;++t)n(e[t])}}}),n.addComponent("page-svg",function(n){function a(){switch(I){case y:case x:return t("<iframe>");case w:case T:return t("<object>").attr({type:p,data:"data:"+p+";base64,"+e.btoa(v)});case b:return t("<div>");case P:return t("<object>");case S:case C:return t("<img>")}}function o(){d&&0!==d.length||(_=!1,d=a()),0===d.parent().length&&d.appendTo(g)}function i(){return _||I===P||I===S?t.Deferred().resolve().promise({abort:function(){}}):n.get("page-svg",h)}function r(e){var t=e.querySelectorAll("use");[].forEach.call(t,function(t){var n=t.getAttribute("xlink:href"),a=e.querySelector(n).cloneNode(),o=t.parentNode;a.removeAttribute("id"),a.setAttribute("transform",t.getAttribute("transform")),o.replaceChild(a,t)})}function s(t){var a,o,i,s,c,u=d[0].contentDocument,g=d[0].contentWindow||u&&u.defaultView;switch(I){case y:O.ielt10&&(t=t.replace(/<xhtml:link.*/,"")),s=m+t,O.ielt10?u.body.innerHTML=s:(u.documentElement.innerHTML=s,(O.ios||O.safari)&&O.version<7&&r(u)),i=u.getElementsByTagName("svg")[0];break;case x:u.documentElement.innerHTML=m;var f=u.getElementsByTagName("head")[0]||u.documentElement,v=u.createElement("script"),L="("+l+")()";v.type="text/javascript";try{v.appendChild(document.createTextNode(L))}catch(E){v.text=L}return f.insertBefore(v,f.firstChild),void("complete"===u.readyState?g.loadSVG(t):g.onload=function(){this.loadSVG(t)});case T:a=new A,o=a.parseFromString(t,p),i=u.importNode(o.documentElement,!0),u.documentElement.appendChild(i);break;case w:g.loadSVG(t),i=u.querySelector("svg");break;case b:a=new A,o=a.parseFromString(t,p),i=document.importNode(o.documentElement,!0),d.append(i);break;case P:d.attr({type:p,data:n.getDataProvider("page-svg").getURL(h)}),i=d[0];break;case S:i=d[0],i.src=n.getDataProvider("page-svg").getURL(h);break;case C:i=d[0],c="data:"+p,i.src=!O.ie&&e.btoa?c+";base64,"+e.btoa(t):c+","+encodeURIComponent(t)}i.setAttribute("width","100%"),i.setAttribute("height","100%")}function l(){e.loadSVG=function(t){var n=new e.DOMParser,a=n.parseFromString(t,"image/svg+xml"),o=document.importNode(a.documentElement,!0);o.setAttribute("width","100%"),o.setAttribute("height","100%"),document.body?document.body.appendChild(o):document.documentElement.appendChild(o)}}function c(e){L||E||(!_&&e&&(s(e),_=!0,U||(f.abort(),f=null)),0===d.parent().length&&d.appendTo(g),d.show())}function u(e){n.broadcast("asseterror",e),_=!1,f&&f.abort()}var d,g,f,h,p="image/svg+xml",m="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",v='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+l+")()]]></script></svg>",y=1,T=2,b=3,P=4,S=5,w=6,x=7,C=8,O=n.getUtility("browser"),A=e.DOMParser,L=!1,E=!1,_=!1,R=n.getConfig(),U=O.mobile||O.ielt10,I=O.ielt11||O.firefox?C:y;return{init:function(e,t){g=e,h=t,I=R.embedStrategy||I},destroy:function(){L=!0,U=!0,this.unload(),g.empty()},prepare:function(){o()},preload:function(){this.prepare(),f||(f=i())},load:function(){return E=!1,this.preload(),f.done(c).fail(u),f},unload:function(){E=!0,f&&"resolved"!==f.state()&&(f.abort(),f=null),U?(d&&(d.remove(),d=null),_=!1):d&&d.hide()}}}),n.addComponent("page-text",function(e){function n(){return h.enableTextSelection&&!u.ielt9}function a(e){var t,n;!e||f||g||(f=!0,t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,n=document.importNode(t.querySelector("."+c),!0),r.attr("class",n.getAttribute("class")),r.html(n.innerHTML),d.fix(r))}function o(t){t&&e.broadcast("asseterror",t)}function i(){return s||(s=n()?e.get("page-text",l):t.Deferred().resolve().promise({abort:function(){}})),s}var r,s,l,c="crocodoc-page-text",u=e.getUtility("browser"),d=e.getUtility("subpx"),g=!1,f=!1,h=e.getConfig();return{init:function(e,t){r=e,l=t},destroy:function(){g=!0,this.unload(),r.empty()},preload:function(){i()},load:function(){return i().done(a).fail(o)},unload:function(){s&&"resolved"!==s.state()&&(s.abort(),s=null)},enable:function(){r.css("display",""),s&&!f&&(s=null)},disable:function(){r.css("display","none")}}}),n.addComponent("page",function(e){var a,o,i,r,s,l,c,u,d="crocodoc-page-",g=d+"loading",f=d+"error",h=d+"text",p=d+"svg",m=d+"links",v=e.getUtility("support"),y=e.getUtility("common"),T=!1;return{messages:["pageavailable","pagefocus","textenabledchange","zoom"],onmessage:function(e,t){switch(e){case"pageavailable":(t.page===l+1||t.upto>l||t.all===!0)&&u===n.PAGE_STATUS_CONVERTING&&(u=n.PAGE_STATUS_NOT_LOADED);break;case"textenabledchange":t.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":c=s===t.page||y.inArray(s,t.visiblePages)>-1}},init:function(t,c){var d,g,f;a=t,g=t.find("."+p),d=t.find("."+h),f=t.find("."+m),u=c.status||n.PAGE_STATUS_NOT_LOADED,l=c.index,s=l+1,this.config=c,c.url=c.url||"",o=e.createComponent("page-text"),i=e.createComponent(v.svg?"page-svg":"page-img"),o.init(d,s),i.init(g,s),c.enableLinks&&c.links.length&&(r=e.createComponent("page-links"),r.init(f,c.links))},destroy:function(){this.unload()},preload:function(){i.prepare(),u===n.PAGE_STATUS_NOT_LOADED&&(i.preload(),o.preload())},load:function(){var r=this;return T=!0,u===n.PAGE_STATUS_ERROR?!1:u===n.PAGE_STATUS_CONVERTING?!1:(u!==n.PAGE_STATUS_LOADED&&(u=n.PAGE_STATUS_LOADING),t.when(i.load(),o.load()).done(function(){T?u!==n.PAGE_STATUS_LOADED&&(a.removeClass(g),u=n.PAGE_STATUS_LOADED,e.broadcast("pageload",{page:s})):r.unload()}).fail(function(t){u=n.PAGE_STATUS_ERROR,a.addClass(f),e.broadcast("pagefail",{page:l+1,error:t})}))},unload:function(){T=!1,i.unload(),o.unload(),u===n.PAGE_STATUS_LOADED&&(u=n.PAGE_STATUS_NOT_LOADED,a.addClass(g),a.removeClass(f),e.broadcast("pageunload",{page:s}))},enableTextSelection:function(){o.enable(),c&&o.load()},disableTextSelection:function(){o.disable()}}}),n.addComponent("resizer",function(n){function a(){n.broadcast("resize",{width:c,height:u,clientWidth:s,clientHeight:l,offsetWidth:c,offsetHeight:u})}function o(){g.cancelAnimationFrame(d),i(),d=g.requestAnimationFrame(o,r)}function i(){var t=r.offsetHeight,o=r.offsetWidth;return v&&0===m&&0!==e.innerWidth?(m=e.innerWidth,void n.broadcast("layoutchange")):void(t&&(t!==u||o!==c)&&(u=t,c=o,l=r.clientHeight,s=r.clientWidth,a()))}var r,s,l,c,u,d,g=n.getUtility("support"),f=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",h=t(e),p=t(document),m=0,v=function(){try{return e.self!==e.top}catch(t){return!0}}();return{messages:["layoutchange"],onmessage:function(){u=null,i()},init:function(n){r=t(n).get(0),r===e?(r=document.documentElement,h.on("resize",i),i()):o(),p.on(f,i)},destroy:function(){p.off(f,i),h.off("resize",i),g.cancelAnimationFrame(d)}}}),n.addComponent("scroller",function(e){function n(){return{scrollTop:c.scrollTop(),scrollLeft:c.scrollLeft()}}function a(){v=!1,S=null,clearTimeout(u),e.broadcast("scrollend",n())}function o(){v||(v=!0,e.broadcast("scrollstart",n())),clearTimeout(u),u=setTimeout(a,m),w()}function i(){y=!0,T=!1,b=!1,o()}function r(){b=!0,o()}function s(){y=!1,T=!0,P=(new Date).getTime(),b&&l()}function l(){return clearTimeout(u),null===S&&(S=(new Date).getTime()),(new Date).getTime()-S>f?void a():(w(),void(u=setTimeout(l,h)))}var c,u,d=e.getUtility("common"),g=e.getUtility("browser"),f=3e3,h=30,p=200,m=g.mobile?500:250,v=!1,y=!1,T=!1,b=!1,P=0,S=null,w=d.throttle(p,function(){e.broadcast("scroll",n())});return{init:function(e){c=t(e),c.on("scroll",o),c.on("touchstart",i),c.on("touchmove",r),c.on("touchend",s)},destroy:function(){clearTimeout(u),c.off("scroll",o),c.off("touchstart",i),c.off("touchmove",r),c.off("touchend",s)}}}),n.addComponent("viewer-base",function(a){function o(){P.attr(_,b.metadata.version||"0.0.0"),et.mobile&&P.addClass(z),et.ielt9&&P.addClass(V),tt.svg&&P.addClass(k)}function i(){var e=b.metadata;b.numPages=e.numpages,b.pageStart?b.pageStart<0&&(b.pageStart=e.numpages+b.pageStart):b.pageStart=1,b.pageStart=K.clamp(b.pageStart,1,e.numpages),b.pageEnd?b.pageEnd<0&&(b.pageEnd=e.numpages+b.pageEnd):b.pageEnd=e.numpages,b.pageEnd=K.clamp(b.pageEnd,b.pageStart,e.numpages),b.numPages=b.pageEnd-b.pageStart+1}function r(){P.html(Y),b.useWindowAsViewport?(b.$viewport=t(e),P.addClass(N)):b.$viewport=P.find("."+I),b.$doc=P.find("."+U)}function s(){var e,n,a,o,i,r,s,l,c=K.calculatePtSize(),u=b.metadata.dimensions,d="";for(b.pageScale=J/(u.width*c),a=b.zoomLevels[b.zoomLevels.length-1],o=3/b.pageScale;o>a;)a+=a/2,b.zoomLevels.push(a);for(u.exceptions=u.exceptions||{},e=b.pageStart-1;e<b.pageEnd;e++)n=e+1,n in u.exceptions?(i=u.exceptions[n].width,r=u.exceptions[n].height):(i=u.width,r=u.height),s=i*c,l=r*c,s*=b.pageScale,l*=b.pageScale,d+=K.template(Q,{w:s,h:l});b.$pages=t(d).appendTo(b.$doc)}function l(){var e,t,n=b.plugins||{};for(e in n)t=a.createComponent("plugin-"+e),t&&K.isFn(t.init)&&t.init(b.plugins[e])}function c(){o(),s(),d(),f(),w=a.createComponent("lazy-loader"),w.init(b.pages),C=a.createComponent("scroller"),C.init(b.$viewport),O=a.createComponent("resizer"),O.init(b.$viewport),(!b.enableLinks||et.ielt9)&&T.disableLinks(),T.setLayout(b.layout),a.broadcast("ready",{page:b.page||1,numPages:b.numPages}),a.ready()}function u(e){return 0===e||b.conversionIsComplete?n.PAGE_STATUS_NOT_LOADED:n.PAGE_STATUS_CONVERTING}function d(){var e,t,n=[],o=b.pageStart-1,i=b.pageEnd,r=g();for(e=o;i>e;e++)t=a.createComponent("page"),t.init(b.$pages.eq(e-o),{index:e,status:u(e),enableLinks:b.enableLinks,links:r[e],pageScale:b.pageScale}),n.push(t);b.pages=n}function g(){var e,t,n,a=b.metadata.links||[],o=[];for(e=0,t=b.metadata.numpages;t>e;++e)o[e]=[];for(e=0,t=a.length;t>e;++e)n=a[e],o[n.pagenum-1].push(n);return o}function f(){t(document).on("mouseup",p)}function h(t){var n=T.fire("linkclick",t);n.isDefaultPrevented()||(t.uri?e.open(t.uri):t.destination&&T.scrollTo(t.destination.pagenum))}function p(){m()}function m(){var e=K.getSelectedNode(),n=t(e).closest("."+F);P.find("."+H).removeClass(H),e&&P.has(e)&&n.addClass(H)}function v(e){e?A||(P.addClass(D),A=a.createComponent("dragger"),A.init(b.$viewport)):A&&(P.removeClass(D),a.destroyComponent(A),A=null)}function y(){var e;b.queryParams&&(e="string"==typeof b.queryParams?b.queryParams.replace(/^\?/,""):K.param(b.queryParams)),b.queryString=e?"?"+e:""}var T,b,P,S,w,x,C,O,A,L,E="crocodoc-",_="data-svg-version",R=E+"viewer",U=E+"doc",I=E+"viewport",M=E+"viewer-logo",D=E+"draggable",Z=E+"dragging",H=E+"text-selected",z=E+"mobile",V=E+"ielt9",k=E+"supports-svg",N=E+"window-as-viewport",F=E+"page",W=F+"-inner",$=F+"-content",G=F+"-svg",q=F+"-text",j=F+"-links",X=F+"-autoscale",B=F+"-loading",Y='<div tabindex="-1" class="'+I+'"><div class="'+U+'"></div></div><div class="'+M+'"></div>',Q='<div class="'+F+" "+B+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+W+'"><div class="'+$+'"><div class="'+G+'"></div><div class="'+X+'"><div class="'+q+'"></div><div class="'+j+'"></div></div></div></div></div>',J=1024,K=a.getUtility("common"),et=a.getUtility("browser"),tt=a.getUtility("support");return{messages:["asseterror","destroy","dragend","dragstart","fail","layoutchange","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"layoutchange":T.updateLayout();break;case"linkclick":h(t);break;case"zoom":t.zoom*=b.pageScale,t.prevZoom*=b.pageScale,b.enableDragging&&v(t.isDraggable),T.fire(e,t);break;case"dragstart":P.hasClass(Z)||P.addClass(Z),T.fire(e,t);break;case"dragend":P.hasClass(Z)&&P.removeClass(Z),T.fire(e,t);break;default:T.fire(e,t)}},init:function(){if(b=a.getConfig(),T=b.api,b.namespace=R+"-"+b.id,P=b.$el,P.addClass(R),P.addClass(b.namespace),!b.url)throw new Error("no URL given for viewer assets");/\/$/.test(b.url)||(b.url+="/"),et.ielt9&&T.disableTextSelection(),b.url=a.getUtility("url").makeAbsolute(b.url),y(),r(),l()},destroy:function(){t(document).off("mouseup",p),P.empty().removeClass(function(e,t){var n=t.match(new RegExp("crocodoc\\S+","g"));return n&&n.join(" ")}),t(S).remove(),L&&L.abort()},setLayout:function(e){var t,n=b.page,o=b.zoom||1;if(x){if(e===b.layout)return x;n=x.state.currentPage,o=x.state.zoomState}if(t=a.createComponent("layout-"+e),!t)throw new Error("Invalid layout "+e);x&&a.destroyComponent(x);var i=b.layout;return b.layout=e,x=t,x.init(),x.setZoom(o.zoomMode||o.zoom||o),x.scrollTo(n),b.currentLayout=x,a.broadcast("layoutchange",{previousLayout:i,layout:e}),x},loadAssets:function(){var e,n,o,r;L||(n=a.get("metadata"),n.then(function(e){b.metadata=e,i()}),et.ielt9?(S=K.insertCSS(""),b.stylesheet=S.styleSheet,e=t.when("").promise({abort:function(){}})):(e=a.get("stylesheet"),e.then(function(e){S=K.insertCSS(e),b.stylesheet=S.sheet})),b.pageStart&&1!==b.pageStart||(tt.svg?o=a.get("page-svg",1):b.conversionIsComplete&&(o=a.get("page-img",1)),b.enableTextSelection&&(r=a.get("page-text",1))),L=t.when(n,e).fail(function(e){L&&L.abort(),a.ready(),a.broadcast("asseterror",e),a.broadcast("fail",e)}).then(c).promise({abort:function(){L=null,n.abort(),e.abort(),o&&o.abort(),r&&r.abort()}}))}}}),n})}("undefined"!=typeof window?window:this);